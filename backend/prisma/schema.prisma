generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id                 String          @id @default(cuid())
  name               String
  [cite_start]phone              String? [cite: 5389]
  [cite_start]address            String? [cite: 5389, 5574]
  stripeCustomerId   String?         [cite_start]@unique [cite: 5575, 5823]
  [cite_start]users              User[] [cite: 5575, 5823]
  [cite_start]services           Service[] [cite: 5389, 5575, 5823]
  [cite_start]appointments       Appointment[] [cite: 5389, 5575, 5823]
  [cite_start]clients            Client[] [cite: 5575, 5823]
  [cite_start]orders             Order[] [cite: 5575, 5823]
  [cite_start]cashierSessions    CashierSession[] [cite: 5575, 5823]
  [cite_start]subscription       Subscription? [cite: 5575, 5823]
  [cite_start]anamnesisForms     AnamnesisForm[] [cite: 5576, 5824]
  [cite_start]packages           Package[] [cite: 5576, 5824]
  [cite_start]goals              Goal[] [cite: 5576, 5824]
  [cite_start]products           Product[] [cite: 824]
  [cite_start]categories         Category[] [cite: 824]
  [cite_start]brands             Brand[] [cite: 824]
  createdAt          DateTime        @default(now())
  [cite_start]updatedAt          DateTime        @updatedAt [cite: 5576]
}

model User {
  id                   String                @id @default(cuid())
  email                String                @unique
  name                 String
  password             String
  [cite_start]role                 Role                  @default(STAFF) [cite: 5578]
  showInBooking        Boolean               @default(true)
  commission           Decimal?              [cite_start]@db.Decimal(5, 2) [cite: 5579, 5827, 5863]
  [cite_start]workSchedule         Json? [cite: 5579, 5827, 5863, 5959]
  [cite_start]companyId            String [cite: 5580, 5828, 5864, 5960]
  [cite_start]company              Company               @relation(fields: [companyId], references: [id]) [cite: 5580, 5828, 5864, 5960]
  [cite_start]appointments         Appointment[] [cite: 5580, 5828, 5864, 5960]
  [cite_start]services             Service[]             @relation("ServiceToUser") [cite: 5580, 5828, 5864, 5960]
  [cite_start]orders               Order[] [cite: 5581, 5829, 5865, 5961]
  [cite_start]packageSessionUsages PackageSessionUsage[] [cite: 5581, 5829, 5865, 5961]
  [cite_start]goals                Goal[] [cite: 5581, 5829, 5865, 5961]
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
}

model Service {
  [cite_start]id            String        @id @default(cuid()) [cite: 5581, 5830, 5866, 5962]
  [cite_start]name          String [cite: 5582]
  [cite_start]price         Decimal       @db.Decimal(10, 2) [cite: 5582]
  [cite_start]duration      Int [cite: 5582]
  [cite_start]companyId     String [cite: 5582]
  [cite_start]company       Company       @relation(fields: [companyId], references: [id]) [cite: 5582]
  [cite_start]appointments  Appointment[] [cite: 5582]
  [cite_start]orderItems    OrderItem[] [cite: 5582]
  [cite_start]availableTo   User[]        @relation("ServiceToUser") [cite: 5582]
  [cite_start]packages      Package[]     @relation("PackageServices") [cite: 5583, 5831, 5867, 5963]
  [cite_start]goals         Goal[] [cite: 5583, 5831, 5867, 5963]
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Client {
  id               String          @id @default(cuid())
  name             String
  [cite_start]phone            String [cite: 5584, 5832, 5868, 5964]
  [cite_start]birthDate        DateTime? [cite: 5584, 5832, 5868, 5964, 5999]
  [cite_start]notes            String? [cite: 5585, 5833, 5869, 6000]
  [cite_start]companyId        String [cite: 5585, 5833, 5869, 6001]
  [cite_start]company          Company         @relation(fields: [companyId], references: [id]) [cite: 5585]
  [cite_start]orders           Order[] [cite: 5585]
  [cite_start]anamnesisAnswers AnamnesisAnswer[] [cite: 5585]
  [cite_start]packages         ClientPackage[] [cite: 5585]
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
}

model Appointment {
  [cite_start]id                  String                @id @default(cuid()) [cite: 5586, 5835, 5871, 5967, 6002]
  [cite_start]clientName          String [cite: 5586]
  [cite_start]clientPhone         String [cite: 5586]
  [cite_start]start               DateTime [cite: 5586]
  [cite_start]end                 DateTime [cite: 5586]
  [cite_start]notes               String? [cite: 5587, 5836, 5872, 5968, 6003]
  [cite_start]status              AppointmentStatus     @default(SCHEDULED) [cite: 5588, 5837, 5873, 5969, 6004]
  [cite_start]companyId           String [cite: 5588]
  [cite_start]company             Company               @relation(fields: [companyId], references: [id]) [cite: 5588]
  [cite_start]serviceId           String [cite: 5589, 5838, 5874, 5970]
  [cite_start]service             Service               @relation(fields: [serviceId], references: [id]) [cite: 5589, 5838, 5874, 5970]
  [cite_start]userId              String [cite: 5589]
  [cite_start]user                User                  @relation(fields: [userId], references: [id]) [cite: 5589]
  [cite_start]anamnesisAnswers    AnamnesisAnswer[] [cite: 5589]
  [cite_start]packageSessionUsage PackageSessionUsage[] [cite: 5590, 5839, 5875, 5971]
  [cite_start]createdAt           DateTime              @default(now()) [cite: 5590, 5839, 5875, 5971]
  updatedAt           DateTime              @updatedAt
}

model Order {
  id        String      @id @default(cuid())
  total     Decimal     @db.Decimal(10, 2)
  status    OrderStatus @default(OPEN)
  companyId String
  company   Company     @relation(fields: [companyId], references: [id])
  clientId  String
  [cite_start]client    Client      @relation(fields: [clientId], references: [id]) [cite: 5591, 5840, 5876, 5972]
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  items     OrderItem[]
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
}

model OrderItem {
  id        String   @id @default(cuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id])
  [cite_start]serviceId String? [cite: 840]
  service   Service? [cite_start]@relation(fields: [serviceId], references: [id]) [cite: 841, 973]
  [cite_start]productId String? [cite: 841, 973]
  product   Product? [cite_start]@relation(fields: [productId], references: [id]) [cite: 841, 974]
  quantity  Int
  price     Decimal  @db.Decimal(10, 2)
}

model CashierSession {
  id             String        @id @default(cuid())
  openingBalance Decimal       @db.Decimal(10, 2)
  closingBalance Decimal?      [cite_start]@db.Decimal(10, 2) [cite: 5593, 5843, 5878, 5975]
  openedAt       DateTime      @default(now())
  [cite_start]closedAt       DateTime? [cite: 5594, 5844, 5879, 5976]
  [cite_start]status         CashierStatus @default(OPEN) [cite: 5594, 5844, 5879, 5976]
  companyId      String
  company        Company       @relation(fields: [companyId], references: [id])
  transactions   Transaction[]
}

model Transaction {
  id               String          @id @default(cuid())
  type             TransactionType
  [cite_start]amount           Decimal         @db.Decimal(10, 2) [cite: 5595, 5845, 5880, 5977]
  description      String
  cashierSessionId String
  cashierSession   CashierSession  @relation(fields: [cashierSessionId], references: [id])
  createdAt        DateTime        @default(now())
}

model Plan {
  id            String         @id @default(cuid())
  name          String         @unique
  [cite_start]price         Decimal        @db.Decimal(10, 2) [cite: 5596, 5846, 5881, 5978]
  features      Json
  stripePriceId String         @unique
  subscriptions Subscription[]
}

model Subscription {
  id                   String             @id @default(cuid())
  status               SubscriptionStatus @default(INCOMPLETE)
  [cite_start]currentPeriodEnd     DateTime? [cite: 5597, 5847, 5882, 5979]
  companyId            String             @unique
  company              Company            @relation(fields: [companyId], references: [id])
  planId               String
  [cite_start]plan                 Plan               @relation(fields: [planId], references: [id]) [cite: 5598, 5848, 5883, 5980]
  stripeSubscriptionId String?            [cite_start]@unique [cite: 5599, 5849, 5884, 5981]
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
}

model Goal {
  id          String   @id @default(cuid())
  type        GoalType
  targetValue Decimal  @db.Decimal(10, 2)
  month       Int
  [cite_start]year        Int [cite: 5600, 5850, 5885, 5982]
  companyId   String
  company     Company  @relation(fields: [companyId], references: [id])
  [cite_start]userId      String? [cite: 5601, 5851, 5886, 5983]
  user        User?    [cite_start]@relation(fields: [userId], references: [id]) [cite: 5601, 5851, 5886, 5983]
  [cite_start]serviceId   String? [cite: 5602, 5852, 5887, 5984]
  service     Service? [cite_start]@relation(fields: [serviceId], references: [id]) [cite: 5602, 5852, 5887, 5984]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  @@unique([month, year, companyId, userId, serviceId])
}

model AnamnesisForm {
  id          String            @id @default(cuid())
  title       String
  questions   Json
  companyId   String
  company     Company           @relation(fields: [companyId], references: [id])
  [cite_start]answers     AnamnesisAnswer[] [cite: 5603, 5853, 5888, 5985]
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
}

model AnamnesisAnswer {
  id            String        @id @default(cuid())
  formId        String
  form          AnamnesisForm @relation(fields: [formId], references: [id])
  clientId      String
  [cite_start]client        Client        @relation(fields: [clientId], references: [id]) [cite: 5604, 5854, 5889, 5986]
  answers       Json
  [cite_start]appointmentId String? [cite: 5605, 5855, 5890, 5987]
  appointment   Appointment?  [cite_start]@relation(fields: [appointmentId], references: [id]) [cite: 5605, 5855, 5890, 5987]
  createdAt     DateTime      @default(now())
}

model Package {
  id             String          @id @default(cuid())
  name           String
  price          Decimal         @db.Decimal(10, 2)
  sessions       Int
  validityDays   Int
  [cite_start]companyId      String [cite: 5606, 5856, 5891, 5988]
  company        Company         @relation(fields: [companyId], references: [id])
  services       Service[]       @relation("PackageServices")
  clientPackages ClientPackage[]
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
}

model ClientPackage {
  [cite_start]id                String                @id @default(cuid()) [cite: 5607, 5857, 5892, 5989]
  clientId          String
  client            Client                @relation(fields: [clientId], references: [id])
  packageId         String
  [cite_start]package           Package               @relation(fields: [packageId], references: [id]) [cite: 5608, 5858, 5893, 5990]
  sessionsRemaining Int
  expiresAt         DateTime
  createdAt         DateTime              @default(now())
  sessionUsages     PackageSessionUsage[]
}

model PackageSessionUsage {
  id              String        @id @default(cuid())
  clientPackageId String
  clientPackage   ClientPackage @relation(fields: [clientPackageId], references: [id])
  [cite_start]usedAt          DateTime      @default(now()) [cite: 5609, 5859, 5894, 5991]
  appointmentId   String?
  appointment     Appointment?  [cite_start]@relation(fields: [appointmentId], references: [id]) [cite: 5610, 5860, 5895, 5992]
  userId          String
  user            User          @relation(fields: [userId], references: [id])
}

model Category {
  id        String    @id @default(cuid())
  name      String
  companyId String
  company   Company   @relation(fields: [companyId], references: [id])
  products  Product[]
  @@unique([name, companyId])
}

model Brand {
  [cite_start]id        String    @id @default(cuid()) [cite: 861, 993]
  name      String
  companyId String
  company   Company   @relation(fields: [companyId], references: [id])
  products  Product[]
  @@unique([name, companyId])
}

model Product {
  id          String     @id @default(cuid())
  name        String
  description String?
  [cite_start]price       Decimal    @db.Decimal(10, 2) [cite: 862, 994]
  cost        Decimal?   [cite_start]@db.Decimal(10, 2) [cite: 863, 995]
  stock       Int        @default(0)
  companyId   String
  company     Company    @relation(fields: [companyId], references: [id])
  [cite_start]categoryId  String? [cite: 864, 996]
  category    Category?  [cite_start]@relation(fields: [categoryId], references: [id]) [cite: 864, 996]
  [cite_start]brandId     String? [cite: 865, 997]
  brand       Brand?     [cite_start]@relation(fields: [brandId], references: [id]) [cite: 865, 997]
  orderItems  OrderItem[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

enum Role {
  OWNER
  STAFF
}

enum AppointmentStatus {
  SCHEDULED
  CONFIRMED
  CANCELED
  COMPLETED
}

enum OrderStatus {
  OPEN
  FINISHED
  CANCELED
}

enum CashierStatus {
  OPEN
  CLOSED
}

enum TransactionType {
  INCOME
  EXPENSE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  INCOMPLETE
  PAST_DUE
}

enum GoalType {
  TOTAL
  BY_USER
  BY_SERVICE
}